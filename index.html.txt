<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <meta name="theme-color" content="#6AA8FF">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icons/icon-192.png">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <title>Benri â€” Premium Dashboard</title>

  <style>
    /* =========================
       Design Tokens
       ========================= */
    :root{
      --font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", "Meiryo", Arial, sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --space-1: 6px; --space-2: 10px; --space-3: 14px; --space-4: 18px; --space-5: 24px; --space-6: 32px;
      --radius-sm: 12px; --radius-md: 16px; --radius-lg: 22px; --radius-xl: 28px;
      --shadow-sm: 0 10px 20px rgba(0,0,0,.18);
      --shadow-md: 0 18px 40px rgba(0,0,0,.28);
      --shadow-lg: 0 30px 80px rgba(0,0,0,.35);

      --blur: 18px;
      --border: rgba(255,255,255,.12);

      --ease: cubic-bezier(.2,.8,.2,1);
      --dur-fast: 120ms; --dur: 220ms;

      --bg0: #070A14;
      --bg1: #0A1022;
      --card: rgba(255,255,255,.08);
      --card-2: rgba(255,255,255,.06);
      --text: rgba(244,246,255,.92);
      --muted: rgba(210,216,255,.72);
      --faint: rgba(210,216,255,.52);

      --accent: #6AA8FF;
      --accent2: #45D483;
      --warn: #FFCC66;
      --bad: #FF6B6B;

      --ring: rgba(106,168,255,.65);
      --ring2: rgba(69,212,131,.55);
    }

    /* OS high contrast preference: prefers-contrast [6](https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/At-rules/@media/prefers-contrast) */
    @media (prefers-contrast: more){
      :root{
        --border: rgba(255,255,255,.22);
        --text: rgba(255,255,255,.96);
        --muted: rgba(235,240,255,.80);
        --faint: rgba(235,240,255,.68);
        --ring: rgba(255,255,255,.75);
      }
    }

    /* Auto light if OS light */
    @media (prefers-color-scheme: light){
      :root{
        --bg0:#F5F7FF; --bg1:#EEF2FF;
        --card: rgba(255,255,255,.78);
        --card-2: rgba(255,255,255,.66);
        --text: rgba(14,18,40,.92);
        --muted: rgba(52,61,106,.72);
        --faint: rgba(52,61,106,.50);
        --border: rgba(10,20,60,.12);
        --shadow-sm: 0 10px 18px rgba(18,24,60,.10);
        --shadow-md: 0 18px 40px rgba(18,24,60,.14);
        --shadow-lg: 0 30px 70px rgba(18,24,60,.18);
        --ring: rgba(47,107,255,.35);
        --ring2: rgba(16,170,110,.28);
      }
    }

    /* Manual theme */
    html[data-theme="dark"]{ color-scheme: dark; }
    html[data-theme="light"]{
      color-scheme: light;
      --bg0:#F5F7FF; --bg1:#EEF2FF;
      --card: rgba(255,255,255,.78);
      --card-2: rgba(255,255,255,.66);
      --text: rgba(14,18,40,.92);
      --muted: rgba(52,61,106,.72);
      --faint: rgba(52,61,106,.50);
      --border: rgba(10,20,60,.12);
      --shadow-sm: 0 10px 18px rgba(18,24,60,.10);
      --shadow-md: 0 18px 40px rgba(18,24,60,.14);
      --shadow-lg: 0 30px 70px rgba(18,24,60,.18);
      --ring: rgba(47,107,255,.35);
      --ring2: rgba(16,170,110,.28);
    }

    /* High contrast mode toggle:
       ã‚¬ãƒ©ã‚¹ï¼ˆé€æ˜/ã¼ã‹ã—ï¼‰ã¯è¦–èªæ€§ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ãŸã‚ã€HCã§ã¯ã€Œä¸é€æ˜å¯„ã‚Šï¼‹ã¼ã‹ã—å¼±ã‚/ç„¡åŠ¹ã€ã§èª­ã¿ã‚„ã™ã•å„ªå…ˆã€‚[5](https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site) */
    html[data-contrast="high"]{
      --blur: 0px;
      --card: rgba(0,0,0,.92);
      --card-2: rgba(0,0,0,.85);
      --border: rgba(255,255,255,.35);
      --text: rgba(255,255,255,.98);
      --muted: rgba(255,255,255,.82);
      --faint: rgba(255,255,255,.70);
      --ring: rgba(255,255,255,.92);
      --shadow-md: 0 0 0 rgba(0,0,0,0);
      --shadow-lg: 0 0 0 rgba(0,0,0,0);
    }
    html[data-contrast="high"][data-theme="light"]{
      --card: rgba(255,255,255,.98);
      --card-2: rgba(255,255,255,.92);
      --border: rgba(10,20,60,.25);
      --text: rgba(0,0,0,.92);
      --muted: rgba(0,0,0,.72);
      --faint: rgba(0,0,0,.60);
      --ring: rgba(0,0,0,.75);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--font-sans);
      color: var(--text);
      background:
        radial-gradient(1200px 900px at 15% -10%, rgba(106,168,255,.30), transparent 55%),
        radial-gradient(900px 700px at 92% 10%, rgba(69,212,131,.18), transparent 55%),
        radial-gradient(1000px 800px at 70% 100%, rgba(255,204,102,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed; inset:0; pointer-events:none;
      opacity:.06;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.12) 0 1px, transparent 1px 3px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.08) 0 1px, transparent 1px 4px);
      mix-blend-mode: overlay;
    }

    .wrap{ max-width:1160px; margin:0 auto; padding:18px 16px 40px; }
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      background: color-mix(in srgb, var(--bg0) 55%, transparent);
      border-bottom:1px solid var(--border);
    }

    .bar{ display:flex; align-items:center; justify-content:space-between; gap:14px; }
    .brand{ display:flex; align-items:center; gap:14px; min-width:260px; }
    .logo{
      width:44px; height:44px; border-radius:16px;
      background:
        radial-gradient(20px 20px at 30% 30%, rgba(255,255,255,.55), transparent 60%),
        linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent2) 50%, var(--accent) 50%));
      box-shadow: var(--shadow-md);
      position:relative; overflow:hidden;
    }
    .logo::after{ content:""; position:absolute; inset:-20%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 40%);
      transform: rotate(20deg); opacity:.28;
    }
    .title{ display:flex; flex-direction:column; line-height:1.1; }
    .title b{ font-size:14px; letter-spacing:.3px; }
    .title span{ font-size:12px; color:var(--muted); margin-top:4px; font-family:var(--font-mono); }

    .controls{ display:flex; align-items:center; justify-content:flex-end; gap:10px; flex-wrap:wrap; }

    .btn{
      border:1px solid var(--border);
      background: color-mix(in srgb, var(--card) 78%, transparent);
      color: var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      transition: transform var(--dur) var(--ease), background var(--dur) var(--ease), box-shadow var(--dur) var(--ease);
      display:inline-flex; align-items:center; gap:8px; user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: color-mix(in srgb, var(--card) 92%, transparent); box-shadow: var(--shadow-sm); }
    .btn:active{ transform: translateY(0px); }
    .btn.primary{
      border-color: color-mix(in srgb, var(--accent) 40%, var(--border));
      background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 72%, #fff 0%), color-mix(in srgb, var(--accent2) 26%, transparent));
    }
    .btn.danger{
      border-color: color-mix(in srgb, var(--bad) 40%, var(--border));
      background: color-mix(in srgb, var(--bad) 12%, var(--card));
    }
    .btn.ghost{ background: transparent; }

    .badge{
      font-family: var(--font-mono);
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      color: var(--muted);
      background: color-mix(in srgb, var(--card-2) 60%, transparent);
      white-space:nowrap;
    }
    .badge.online{ border-color: color-mix(in srgb, var(--accent2) 45%, var(--border)); }
    .badge.offline{ border-color: color-mix(in srgb, var(--bad) 45%, var(--border)); }

    .field, textarea{
      width:100%;
      border:1px solid var(--border);
      background: color-mix(in srgb, var(--card-2) 85%, transparent);
      color: var(--text);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
      transition: box-shadow var(--dur) var(--ease), border-color var(--dur) var(--ease);
    }
    textarea{ min-height:140px; resize:vertical; line-height:1.55; }
    .btn:focus-visible, .field:focus-visible, textarea:focus-visible{
      box-shadow: 0 0 0 4px var(--ring);
      border-color: color-mix(in srgb, var(--accent) 60%, var(--border));
    }

    .grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; margin-top:16px; }
    .card{
      grid-column: span 12;
      border-radius: var(--radius-xl);
      border:1px solid var(--border);
      background: var(--card);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      box-shadow: var(--shadow-md);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:""; position:absolute; inset:0; pointer-events:none; opacity:.85;
      background:
        radial-gradient(700px 300px at 0% 0%, rgba(255,255,255,.12), transparent 45%),
        radial-gradient(500px 280px at 100% 0%, rgba(255,255,255,.08), transparent 40%),
        radial-gradient(700px 420px at 60% 120%, rgba(255,255,255,.06), transparent 55%);
    }
    .inner{ position:relative; padding:16px; }
    .card h2{
      margin:0 0 12px; font-size:13px; letter-spacing:.3px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .pill{ font-size:11px; padding:6px 10px; border-radius:999px; border:1px solid var(--border);
      color: var(--muted); background: color-mix(in srgb, var(--card-2) 60%, transparent);
      font-family: var(--font-mono);
    }
    .muted{ color: var(--muted); }
    .hint{ color: var(--faint); font-size:12px; margin-top:10px; }
    .mono{ font-family: var(--font-mono); }

    @media (min-width: 860px){
      .span4{ grid-column: span 4; }
      .span6{ grid-column: span 6; }
      .span8{ grid-column: span 8; }
    }

    .kpi{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:12px; margin-top:12px; }
    .kbox{ border-radius: var(--radius-lg); border:1px solid var(--border);
      background: color-mix(in srgb, var(--card-2) 70%, transparent); padding:12px; }
    .kbox .label{ font-size:12px; color: var(--muted); }
    .kbox .value{ font-size:18px; font-weight:800; margin-top:6px; font-family: var(--font-mono); }

    /* Quick actions */
    .quick{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .quick .btn{ padding:10px 12px; }

    /* Timer */
    .timerRow{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width:520px){ .timerRow{ grid-template-columns: 1fr 220px; align-items:center; } }
    .timeBig{ font-size:42px; font-weight:900; letter-spacing:1px; font-family: var(--font-mono);
      display:flex; align-items:center; gap:14px; }
    .ring{ width:58px; height:58px; flex:0 0 auto; }
    .timerBtns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }

    /* Todo */
    .todoTop{ display:grid; grid-template-columns: 1fr; gap:10px; }
    @media (min-width:720px){ .todoTop{ grid-template-columns: 1fr 220px; align-items:end; } }
    .todoAdd{ display:flex; gap:10px; align-items:center; }
    .todoAdd .field{ flex:1; }

    .tabs{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .tab{
      padding:8px 10px; border-radius:999px; border:1px solid var(--border);
      background: color-mix(in srgb, var(--card-2) 55%, transparent);
      color: var(--muted); cursor:pointer; font-size:12px; user-select:none;
    }
    .tab[aria-selected="true"]{
      background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 40%, transparent), color-mix(in srgb, var(--accent2) 20%, transparent));
      color: var(--text);
      border-color: color-mix(in srgb, var(--accent) 45%, var(--border));
    }

    .todoList{ display:flex; flex-direction:column; gap:10px; margin-top:12px; }
    .todoItem{
      border-radius: var(--radius-lg); border:1px solid var(--border);
      background: color-mix(in srgb, var(--card-2) 70%, transparent);
      padding:12px; display:flex; align-items:center; justify-content:space-between; gap:10px;
      transition: transform var(--dur) var(--ease), box-shadow var(--dur) var(--ease);
    }
    .todoItem:hover{ transform: translateY(-1px); box-shadow: var(--shadow-sm); }
    .todoLeft{ display:flex; align-items:center; gap:10px; min-width:0; flex:1; }
    .drag{ cursor: grab; color: var(--muted); user-select:none; font-family: var(--font-mono);
      padding:4px 6px; border-radius:10px; border:1px dashed color-mix(in srgb, var(--muted) 20%, transparent); }
    .todoText{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; flex:1; }
    .todoItem.done .todoText{ text-decoration: line-through; opacity:.65; }
    .todoRight{ display:flex; gap:8px; align-items:center; }
    .progressBar{ height:10px; border-radius:999px; background: color-mix(in srgb, var(--card-2) 55%, transparent);
      border:1px solid var(--border); overflow:hidden; margin-top:12px; }
    .progressBar > div{ height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius:999px; transition: width var(--dur) var(--ease); }

    /* Links */
    .links{ display:grid; grid-template-columns: 1fr; gap:10px; margin-top:10px; }
    .link{
      text-decoration:none; border-radius: var(--radius-lg); border:1px solid var(--border);
      background: color-mix(in srgb, var(--card-2) 70%, transparent);
      padding:12px; display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .link .meta{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .link .meta b{ font-size:13px; }
    .link .meta small{ font-size:11px; color: var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:52ch; }

    /* Modal (Welcome / Help) */
    .overlay{
      position:fixed; inset:0; background: rgba(0,0,0,.45);
      display:none; align-items:center; justify-content:center; padding: 18px; z-index: 200;
    }
    .overlay.open{ display:flex; }
    .modal{
      width:min(720px, 100%);
      border-radius: var(--radius-xl);
      border:1px solid var(--border);
      background: var(--card);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      box-shadow: var(--shadow-lg);
      overflow:hidden;
    }
    .modal .mhead{ padding: 14px 16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
    .modal .mbody{ padding: 16px; }
    .modal h3{ margin:0; font-size:14px; letter-spacing:.2px; }
    .list{ margin: 10px 0 0; padding-left: 18px; color: var(--muted); }
    .list li{ margin: 6px 0; }
    footer{ text-align:center; padding: 22px 16px; color: var(--muted); font-size: 12px; }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; }
    }
  </style>
</head>

<body>
<header>
  <div class="wrap bar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <b>Benri â€” Premium Dashboard</b>
        <span id="nowText">â€”</span>
      </div>
    </div>

    <div class="controls">
      <span class="badge" id="netBadge">â€”</span>
      <button class="btn" id="helpBtn" title="ä½¿ã„æ–¹">â“ Help</button>
      <button class="btn" id="installBtn" style="display:none" title="ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ">â¬‡ï¸ Install</button>
      <button class="btn" id="contrastBtn" title="é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ">âš¡ Contrast</button>
      <button class="btn" id="fontBtn" title="ãƒ•ã‚©ãƒ³ãƒˆåˆ‡æ›¿ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ã®ã¿æ¨å¥¨ï¼‰">Aa Font</button>
      <button class="btn" id="themeBtn" title="ãƒ†ãƒ¼ãƒ autoâ†’darkâ†’light">ğŸŒ“ Theme</button>
      <button class="btn ghost" id="exportBtn">â¬‡ï¸ Export</button>
      <button class="btn ghost" id="importBtn">â¬†ï¸ Import</button>
      <button class="btn danger" id="resetBtn">ğŸ—‘ï¸ Reset</button>
      <input id="importFile" type="file" accept="application/json" hidden />
    </div>
  </div>
</header>

<main class="wrap">
  <section class="grid">
    <!-- Status + Quick Start -->
    <article class="card span6">
      <div class="inner">
        <h2>ä»Šæ—¥ã®çŠ¶æ³ <span class="pill" id="statusPill">Ready</span></h2>
        <div class="kpi">
          <div class="kbox"><div class="label">æœªå®Œäº† ToDo</div><div class="value" id="kpiTodo">0</div></div>
          <div class="kbox"><div class="label">ãƒ¡ãƒ¢æ–‡å­—æ•°</div><div class="value" id="kpiMemo">0</div></div>
          <div class="kbox"><div class="label">ãƒ•ã‚©ãƒ¼ã‚«ã‚¹(åˆ†)</div><div class="value" id="kpiFocus">0</div></div>
        </div>

        <div class="quick" aria-label="quick actions">
          <button class="btn primary" id="quickAdd">ï¼‹ ã™ãè¿½åŠ </button>
          <button class="btn" id="quickFocus">â± 25åˆ†é›†ä¸­</button>
          <button class="btn" id="quickClear">âœ… å®Œäº†ã‚’å‰Šé™¤</button>
        </div>

        <div class="hint">â€œè¿·ã‚ãªã„â€ãŸã‚ã®æœ€çŸ­å°ç·šï¼šâ‘ ï¼‹è¿½åŠ  â‘¡25åˆ†é›†ä¸­ â‘¢çµ‚ã‚ã£ãŸã‚‰ãƒã‚§ãƒƒã‚¯ã€‚</div>
      </div>
    </article>

    <!-- Timer -->
    <article class="card span6">
      <div class="inner">
        <h2>ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚¤ãƒãƒ¼ <span class="pill mono" id="timerState">â€”</span></h2>

        <div class="timerRow">
          <div>
            <div class="timeBig">
              <svg class="ring" viewBox="0 0 64 64" aria-hidden="true">
                <defs>
                  <linearGradient id="g" x1="0" x2="1">
                    <stop offset="0" stop-color="var(--accent)"/>
                    <stop offset="1" stop-color="var(--accent2)"/>
                  </linearGradient>
                </defs>
                <circle cx="32" cy="32" r="24" fill="none" stroke="color-mix(in srgb, var(--border) 70%, transparent)" stroke-width="8"/>
                <circle id="ringProg" cx="32" cy="32" r="24" fill="none" stroke="url(#g)" stroke-width="8" stroke-linecap="round"
                        stroke-dasharray="150.796" stroke-dashoffset="150.796"
                        transform="rotate(-90 32 32)"/>
              </svg>
              <span id="timeText">25:00</span>
            </div>

            <div class="timerBtns">
              <button class="btn primary" id="startBtn">â–¶ï¸ é–‹å§‹</button>
              <button class="btn" id="pauseBtn">â¸ ä¸€æ™‚åœæ­¢</button>
              <button class="btn danger" id="stopBtn">â¹ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <div class="tabs" aria-label="timer presets">
              <button class="tab" id="p25" type="button">25åˆ†</button>
              <button class="tab" id="p50" type="button">50åˆ†</button>
              <button class="tab" id="p5"  type="button">5åˆ†</button>
            </div>

            <div class="hint">é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆONã ã¨ã€ã‚¬ãƒ©ã‚¹ã®é€æ˜/ã¼ã‹ã—ã‚’æŠ‘ãˆã¦èª­ã¿ã‚„ã™ã•å„ªå…ˆã€‚[5](https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site)</div>
          </div>

          <div>
            <label class="muted" for="minutesInput">åˆ†æ•°ï¼ˆ1ã€œ180ï¼‰</label>
            <input class="field mono" id="minutesInput" type="number" min="1" max="180" value="25" />
          </div>
        </div>
      </div>
    </article>

    <!-- Todo -->
    <article class="card span8">
      <div class="inner">
        <h2>ToDo <span class="pill mono" id="todoMeta">0 items</span></h2>

        <div class="todoTop">
          <div>
            <div class="todoAdd">
              <input class="field" id="todoInput" type="text" placeholder="ä¾‹ï¼šè³‡æ–™ã®ä¸‹æ›¸ãï¼ˆEnterã§è¿½åŠ ï¼‰" />
              <button class="btn primary" id="addTodoBtn">ï¼‹ è¿½åŠ </button>
              <button class="btn danger" id="clearDoneBtn">å®Œäº†ã‚’å‰Šé™¤</button>
            </div>

            <div class="tabs" role="tablist" aria-label="todo filter">
              <button class="tab" id="tabAll" role="tab" aria-selected="true">All</button>
              <button class="tab" id="tabActive" role="tab" aria-selected="false">Active</button>
              <button class="tab" id="tabDone" role="tab" aria-selected="false">Done</button>
            </div>

            <div class="progressBar" aria-label="completion progress"><div id="todoProgress"></div></div>
          </div>

          <div>
            <label class="muted" for="todoSearch">æ¤œç´¢</label>
            <input class="field" id="todoSearch" type="search" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰â€¦" />
          </div>
        </div>

        <div class="todoList" id="todoList" aria-live="polite"></div>
        <div class="hint">ä¸¦ã¹æ›¿ãˆï¼šå·¦ã®ã€Œâ‹®â‹®ã€ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã€‚ / ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼š<span class="mono">?</span> ã§ãƒ˜ãƒ«ãƒ—ã€‚</div>
      </div>
    </article>

    <!-- Links -->
    <article class="card span4">
      <div class="inner">
        <h2>ã‚ˆãä½¿ã†ãƒªãƒ³ã‚¯ <span class="pill mono" id="linkMeta">â€”</span></h2>
        <div style="display:grid; gap:10px;">
          <input class="field" id="linkTitle" type="text" placeholder="è¡¨ç¤ºåï¼ˆä¾‹ï¼šGmailï¼‰" />
          <input class="field mono" id="linkUrl" type="url" placeholder="URLï¼ˆhttps://...ï¼‰" />
          <button class="btn primary" id="addLinkBtn">ï¼‹ ç™»éŒ²</button>
        </div>

        <div class="links" id="links"></div>
        <div class="hint">ãƒªãƒ³ã‚¯ã¯â€œé–‹ãå›æ•°ãŒå¤šã„é †â€ã«ä¸Šã¸ãƒ‰ãƒ©ãƒƒã‚°â€¦ã¯æ¬¡ã®æ‹¡å¼µã§è¿½åŠ å¯èƒ½ã€‚</div>
      </div>
    </article>

    <!-- Memo -->
    <article class="card span12">
      <div class="inner">
        <h2>ãƒ¡ãƒ¢ï¼ˆè‡ªå‹•ä¿å­˜ï¼‰ <span class="pill mono" id="savedText">â€”</span></h2>
        <textarea id="memo" class="field" placeholder="ã“ã“ã«ãƒ¡ãƒ¢ã€‚å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•ã§ä¿å­˜ã€‚"></textarea>

        <div class="timerBtns" style="margin-top:12px">
          <button class="btn" id="copyMemoBtn">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
          <button class="btn danger" id="clearMemoBtn">ğŸ§½ ã‚¯ãƒªã‚¢</button>
        </div>
        <div class="hint">PWAã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚‚OKï¼ˆService Workerã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰ã€‚[3](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers)</div>
      </div>
    </article>
  </section>
</main>

<footer>
  GitHub Pages ã§å…¬é–‹ã™ã‚‹ãªã‚‰ã€Settings â†’ Pages â†’ ã€ŒDeploy from a branchã€ã§ãƒ–ãƒ©ãƒ³ãƒã¨ / ã‹ /docs ã‚’é¸ã¶ï¼ˆå…¬å¼ï¼‰ã€‚[7](https://izurutechblog.com/2025/12/19/javascript-todo-list/)
</footer>

<!-- Help / Welcome Modal -->
<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal">
    <div class="mhead">
      <h3 id="modalTitle">Benri ã®ä½¿ã„æ–¹ï¼ˆæœ€çŸ­ï¼‰</h3>
      <button class="btn" id="closeHelp">âœ•</button>
    </div>
    <div class="mbody">
      <b>3ã‚¹ãƒ†ãƒƒãƒ—ã ã‘è¦šãˆã‚Œã°OK</b>
      <ol class="list">
        <li><b>ï¼‹ è¿½åŠ </b>ï¼šã‚„ã‚‹ã“ã¨ã‚’æ›¸ãï¼ˆEnterã§ã‚‚è¿½åŠ ï¼‰</li>
        <li><b>25åˆ†é›†ä¸­</b>ï¼šã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ â†’ çµ‚ã‚ã£ãŸã‚‰ãƒã‚§ãƒƒã‚¯</li>
        <li><b>å®Œäº†ã‚’å‰Šé™¤</b>ï¼šç‰‡ä»˜ã‘ã¦ã‚¹ãƒƒã‚­ãƒª</li>
      </ol>

      <b style="display:block; margin-top:14px;">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</b>
      <ul class="list">
        <li><span class="mono">?</span>ï¼šã“ã®ãƒ˜ãƒ«ãƒ—</li>
        <li><span class="mono">/</span>ï¼šToDoæ¤œç´¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹</li>
        <li><span class="mono">n</span>ï¼šToDoå…¥åŠ›ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹</li>
      </ul>

      <b style="display:block; margin-top:14px;">è¦‹ã‚„ã™ã•è¨­å®š</b>
      <ul class="list">
        <li><b>âš¡ Contrast</b>ï¼šé«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼ˆé€æ˜/ã¼ã‹ã—ã‚’æŠ‘ãˆã‚‹ï¼‰[5](https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site)</li>
        <li><b>Aa Font</b>ï¼šGoogle Fontsï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ã®ã¿æ¨å¥¨ï¼‰</li>
      </ul>
    </div>
  </div>
</div>

<script>
  // =========================
  // Storage (localStorage is string only)
  // =========================
  const KEY = "benri_dashboard_pwa_v1";
  const defaultState = () => ({
    theme: "auto",     // auto | dark | light
    contrast: "auto",  // auto | high | normal
    font: "system",    // system | google
    todos: [],
    memo: "",
    links: [
      { title: "Google", url: "https://www.google.com" },
      { title: "YouTube", url: "https://www.youtube.com" }
    ],
    timer: { minutes: 25, remainingSec: 1500, running: false, focusMinutesDone: 0 },
    ui: { todoFilter: "all", todoSearch: "" },
    meta: { memoSavedAt: null, welcomed: false }
  });

  function loadState(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return defaultState();
      const parsed = JSON.parse(raw);
      return { ...defaultState(), ...parsed };
    }catch{
      return defaultState();
    }
  }
  function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }
  let state = loadState();

  // =========================
  // Helpers
  // =========================
  const $ = (q) => document.querySelector(q);
  const pad = (n)=> String(n).padStart(2,"0");
  const escapeHtml = (s)=> String(s).replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[c]));
  const now = ()=> new Date();

  // =========================
  // Theme / Contrast / Font
  // =========================
  function applyTheme(){
    if(state.theme === "dark") document.documentElement.dataset.theme = "dark";
    else if(state.theme === "light") document.documentElement.dataset.theme = "light";
    else document.documentElement.removeAttribute("data-theme");
  }
  function applyContrast(){
    if(state.contrast === "high") document.documentElement.dataset.contrast = "high";
    else document.documentElement.removeAttribute("data-contrast");
  }

  function ensureGoogleFont(on){
    // å¤–éƒ¨èª­ã¿è¾¼ã¿ãªã®ã§ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é‡è¦–ãªã‚‰ system ã®ã¾ã¾ã§OKï¼ˆãƒˆã‚°ãƒ«ã§é¸ã¹ã‚‹ã‚ˆã†ã«ã—ã¦ã‚‹ï¼‰
    const id = "gf";
    const existing = document.getElementById(id);
    if(on){
      if(existing) return;
      const pre1 = document.createElement("link");
      pre1.rel = "preconnect"; pre1.href = "https://fonts.googleapis.com";
      const pre2 = document.createElement("link");
      pre2.rel = "preconnect"; pre2.href = "https://fonts.gstatic.com"; pre2.crossOrigin = "anonymous";
      const link = document.createElement("link");
      link.id = id;
      link.rel = "stylesheet";
      link.href = "https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap";
      document.head.appendChild(pre1);
      document.head.appendChild(pre2);
      document.head.appendChild(link);
      document.documentElement.style.setProperty("--font-sans", `"Inter", ${getComputedStyle(document.documentElement).getPropertyValue("--font-sans")}`);
    }else{
      if(existing) existing.remove();
      document.documentElement.style.removeProperty("--font-sans");
    }
  }

  function applyAll(){
    applyTheme();
    applyContrast();
    ensureGoogleFont(state.font === "google");
  }

  // =========================
  // Refs
  // =========================
  const nowText = $("#nowText");
  const netBadge = $("#netBadge");
  const themeBtn = $("#themeBtn");
  const contrastBtn = $("#contrastBtn");
  const fontBtn = $("#fontBtn");
  const helpBtn = $("#helpBtn");
  const overlay = $("#overlay");
  const closeHelp = $("#closeHelp");

  const installBtn = $("#installBtn");

  const kpiTodo = $("#kpiTodo");
  const kpiMemo = $("#kpiMemo");
  const kpiFocus = $("#kpiFocus");
  const statusPill = $("#statusPill");

  const quickAdd = $("#quickAdd");
  const quickFocus = $("#quickFocus");
  const quickClear = $("#quickClear");

  const timerState = $("#timerState");
  const minutesInput = $("#minutesInput");
  const timeText = $("#timeText");
  const ringProg = $("#ringProg");
  const startBtn = $("#startBtn");
  const pauseBtn = $("#pauseBtn");
  const stopBtn = $("#stopBtn");
  const p25 = $("#p25"), p50 = $("#p50"), p5 = $("#p5");

  const todoMeta = $("#todoMeta");
  const todoInput = $("#todoInput");
  const addTodoBtn = $("#addTodoBtn");
  const clearDoneBtn = $("#clearDoneBtn");
  const todoList = $("#todoList");
  const tabAll = $("#tabAll"), tabActive = $("#tabActive"), tabDone = $("#tabDone");
  const todoSearch = $("#todoSearch");
  const todoProgress = $("#todoProgress");

  const linkMeta = $("#linkMeta");
  const linkTitle = $("#linkTitle");
  const linkUrl = $("#linkUrl");
  const addLinkBtn = $("#addLinkBtn");
  const linksEl = $("#links");

  const memo = $("#memo");
  const copyMemoBtn = $("#copyMemoBtn");
  const clearMemoBtn = $("#clearMemoBtn");
  const savedText = $("#savedText");

  const exportBtn = $("#exportBtn");
  const importBtn = $("#importBtn");
  const importFile = $("#importFile");
  const resetBtn = $("#resetBtn");

  // =========================
  // Clock + Net badge
  // =========================
  function tickClock(){
    const d = now();
    nowText.textContent = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }
  function tickNet(){
    const online = navigator.onLine;
    netBadge.textContent = online ? "ONLINE" : "OFFLINE";
    netBadge.className = "badge " + (online ? "online" : "offline");
  }
  tickClock(); tickNet();
  setInterval(tickClock, 1000 * 10);
  window.addEventListener("online", tickNet);
  window.addEventListener("offline", tickNet);

  // =========================
  // Help / Welcome
  // =========================
  function openHelp(){ overlay.classList.add("open"); }
  function closeHelpModal(){ overlay.classList.remove("open"); }
  helpBtn.addEventListener("click", openHelp);
  closeHelp.addEventListener("click", closeHelpModal);
  overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeHelpModal(); });

  // first run welcome
  if(!state.meta.welcomed){
    state.meta.welcomed = true;
    saveState();
    openHelp();
  }

  // =========================
  // Buttons: Theme / Contrast / Font
  // =========================
  themeBtn.addEventListener("click", ()=>{
    state.theme = state.theme === "auto" ? "dark" : (state.theme === "dark" ? "light" : "auto");
    saveState(); applyAll(); render();
  });

  contrastBtn.addEventListener("click", ()=>{
    // auto -> high -> normal -> auto
    state.contrast = state.contrast === "auto" ? "high" : (state.contrast === "high" ? "normal" : "auto");
    saveState(); applyAll(); render();
  });

  fontBtn.addEventListener("click", ()=>{
    state.font = state.font === "system" ? "google" : "system";
    saveState(); applyAll(); render();
  });

  // =========================
  // PWA Install prompt
  // =========================
  let deferredPrompt = null;
  window.addEventListener("beforeinstallprompt", (e)=>{
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = "inline-flex";
  });

  installBtn.addEventListener("click", async ()=>{
    if(!deferredPrompt) return;
    deferredPrompt.prompt();
    try{ await deferredPrompt.userChoice; }catch{}
    deferredPrompt = null;
    installBtn.style.display = "none";
  });

  // Service Worker register (offline) [3](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers)[4](https://zenn.dev/peter_norio/articles/2896d638dece0e)
  if("serviceWorker" in navigator){
    window.addEventListener("load", ()=>{
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    });
  }

  // =========================
  // Timer
  // =========================
  let timerId = null;
  const CIRC = 2 * Math.PI * 24;
  ringProg.setAttribute("stroke-dasharray", CIRC.toFixed(3));

  function fmt(sec){ const m = Math.floor(sec/60), s = sec % 60; return `${pad(m)}:${pad(s)}`; }
  function updateRing(){
    const total = state.timer.minutes * 60;
    const remain = state.timer.remainingSec;
    const p = total > 0 ? (remain / total) : 0;
    ringProg.setAttribute("stroke-dashoffset", (CIRC * (1 - p)).toFixed(3));
  }
  function setMinutes(min){
    const m = Math.max(1, Math.min(180, Number(min)||25));
    state.timer.minutes = m;
    state.timer.remainingSec = m*60;
    state.timer.running = false;
    saveState(); render();
    if(timerId){ clearInterval(timerId); timerId = null; }
  }
  function beep(){
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type="sine"; o.frequency.value = 880; g.gain.value = 0.08;
      o.connect(g); g.connect(ctx.destination);
      o.start(); setTimeout(()=>{ o.stop(); ctx.close(); }, 280);
    }catch{}
  }
  function startTimer(){
    if(state.timer.running) return;
    state.timer.running = true;
    saveState(); render();
    timerId = setInterval(()=>{
      if(!state.timer.running) return;
      state.timer.remainingSec -= 1;
      if(state.timer.remainingSec <= 0){
        state.timer.remainingSec = 0;
        state.timer.running = false;
        state.timer.focusMinutesDone += state.timer.minutes;
        beep();
        saveState(); render();
        clearInterval(timerId); timerId = null;
        return;
      }
      saveState(); render(false);
    }, 1000);
  }
  function pauseTimer(){
    state.timer.running = false;
    saveState(); render();
    if(timerId){ clearInterval(timerId); timerId = null; }
  }
  function stopTimer(){
    state.timer.running = false;
    state.timer.remainingSec = state.timer.minutes*60;
    saveState(); render();
    if(timerId){ clearInterval(timerId); timerId = null; }
  }

  minutesInput.addEventListener("change", e=> setMinutes(e.target.value));
  p25.addEventListener("click", ()=>{ minutesInput.value=25; setMinutes(25); });
  p50.addEventListener("click", ()=>{ minutesInput.value=50; setMinutes(50); });
  p5.addEventListener("click",  ()=>{ minutesInput.value=5;  setMinutes(5);  });
  startBtn.addEventListener("click", startTimer);
  pauseBtn.addEventListener("click", pauseTimer);
  stopBtn.addEventListener("click", stopTimer);

  // =========================
  // Todo
  // =========================
  function addTodo(text){
    const t = (text||"").trim();
    if(!t) return;
    state.todos.unshift({ id: crypto.randomUUID(), text: t, done:false, createdAt: Date.now() });
    saveState(); render();
  }
  addTodoBtn.addEventListener("click", ()=>{ addTodo(todoInput.value); todoInput.value=""; todoInput.focus(); });
  todoInput.addEventListener("keydown", (e)=>{
    if(e.key==="Enter"){ e.preventDefault(); addTodo(todoInput.value); todoInput.value=""; }
  });

  clearDoneBtn.addEventListener("click", ()=>{
    state.todos = state.todos.filter(t=>!t.done);
    saveState(); render();
  });

  todoSearch.addEventListener("input", ()=>{
    state.ui.todoSearch = todoSearch.value;
    saveState(); render();
  });

  function setFilter(f){ state.ui.todoFilter = f; saveState(); render(); }
  tabAll.addEventListener("click", ()=> setFilter("all"));
  tabActive.addEventListener("click", ()=> setFilter("active"));
  tabDone.addEventListener("click", ()=> setFilter("done"));

  function toggleTodo(id){
    const x = state.todos.find(t=>t.id===id);
    if(!x) return;
    x.done = !x.done;
    saveState(); render();
  }
  function deleteTodo(id){
    state.todos = state.todos.filter(t=>t.id!==id);
    saveState(); render();
  }

  // Drag reorder
  let dragId = null;
  function onDragStart(e, id){
    dragId = id;
    e.dataTransfer.effectAllowed = "move";
    e.dataTransfer.setData("text/plain", id);
  }
  function onDragOver(e){
    e.preventDefault();
    e.dataTransfer.dropEffect = "move";
  }
  function onDrop(e, targetId){
    e.preventDefault();
    const src = dragId || e.dataTransfer.getData("text/plain");
    if(!src || src === targetId) return;
    const a = state.todos.findIndex(t=>t.id===src);
    const b = state.todos.findIndex(t=>t.id===targetId);
    if(a<0 || b<0) return;
    const [moved] = state.todos.splice(a,1);
    state.todos.splice(b,0,moved);
    saveState(); render();
  }

  // =========================
  // Links
  // =========================
  function addLink(title, url){
    const t = (title||"").trim();
    const u = (url||"").trim();
    if(!t || !u) return;
    state.links.unshift({ title:t, url:u });
    linkTitle.value=""; linkUrl.value="";
    saveState(); render();
  }
  function deleteLink(idx){
    state.links.splice(idx,1);
    saveState(); render();
  }
  addLinkBtn.addEventListener("click", ()=> addLink(linkTitle.value, linkUrl.value));

  // =========================
  // Memo
  // =========================
  memo.value = state.memo || "";
  memo.addEventListener("input", ()=>{
    state.memo = memo.value;
    state.meta.memoSavedAt = Date.now();
    saveState(); render(false);
  });
  copyMemoBtn.addEventListener("click", async ()=>{
    try{
      await navigator.clipboard.writeText(memo.value);
      savedText.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ";
      setTimeout(()=>render(false), 900);
    }catch{
      savedText.textContent = "ã‚³ãƒ”ãƒ¼å¤±æ•—ï¼ˆæ¨©é™/è¨­å®šï¼‰";
    }
  });
  clearMemoBtn.addEventListener("click", ()=>{
    state.memo = ""; state.meta.memoSavedAt = Date.now();
    memo.value = "";
    saveState(); render();
  });

  // =========================
  // Export / Import / Reset
  // =========================
  exportBtn.addEventListener("click", ()=>{
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "benri-dashboard-backup.json";
    a.click();
    URL.revokeObjectURL(a.href);
  });
  importBtn.addEventListener("click", ()=> importFile.click());
  importFile.addEventListener("change", async ()=>{
    const file = importFile.files?.[0];
    if(!file) return;
    try{
      const txt = await file.text();
      const obj = JSON.parse(txt);
      state = { ...defaultState(), ...obj };
      saveState(); applyAll(); render();
    }catch{
      alert("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆJSONå½¢å¼ã‚’ç¢ºèªï¼‰");
    }finally{
      importFile.value="";
    }
  });
  resetBtn.addEventListener("click", ()=>{
    if(!confirm("æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
    state = defaultState();
    saveState(); applyAll(); render();
    openHelp();
  });

  // =========================
  // Quick actions (make it easier)
  // =========================
  quickAdd.addEventListener("click", ()=>{ todoInput.focus(); todoInput.select(); });
  quickFocus.addEventListener("click", ()=>{ minutesInput.value=25; setMinutes(25); startTimer(); });
  quickClear.addEventListener("click", ()=>{ clearDoneBtn.click(); });

  // Keyboard shortcuts
  window.addEventListener("keydown", (e)=>{
    if(e.key === "?" ){ openHelp(); }
    if(e.key === "/" && document.activeElement?.tagName !== "INPUT" && document.activeElement?.tagName !== "TEXTAREA"){
      e.preventDefault(); todoSearch.focus(); todoSearch.select();
    }
    if(e.key.toLowerCase() === "n" && document.activeElement?.tagName !== "INPUT" && document.activeElement?.tagName !== "TEXTAREA"){
      todoInput.focus(); todoInput.select();
    }
    if(e.key === "Escape"){ closeHelpModal(); }
  });

  // =========================
  // Render
  // =========================
  function render(updateAll = true){
    applyAll();

    // Timer
    minutesInput.value = state.timer.minutes;
    timeText.textContent = fmt(state.timer.remainingSec);
    timerState.textContent = state.timer.running ? "Focusing" : "Idle";
    statusPill.textContent = state.timer.running ? "Focusing" : "Ready";
    updateRing();

    // KPIs
    const undone = state.todos.filter(t=>!t.done).length;
    kpiTodo.textContent = String(undone);
    kpiMemo.textContent = String((state.memo||"").length);
    kpiFocus.textContent = String(state.timer.focusMinutesDone);

    // Saved time
    if(state.meta.memoSavedAt){
      const d = new Date(state.meta.memoSavedAt);
      savedText.textContent = `ä¿å­˜ ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }else{
      savedText.textContent = "â€”";
    }

    // Meta
    todoMeta.textContent = `${state.todos.length} items`;
    linkMeta.textContent = `${state.links.length} links`;

    // Tabs
    const f = state.ui.todoFilter;
    tabAll.setAttribute("aria-selected", f==="all");
    tabActive.setAttribute("aria-selected", f==="active");
    tabDone.setAttribute("aria-selected", f==="done");

    // Progress
    const total = state.todos.length || 0;
    const done = state.todos.filter(t=>t.done).length;
    todoProgress.style.width = (total ? Math.round((done/total)*100) : 0) + "%";

    if(!updateAll) return;

    // Todo list filtered + searched
    const q = (state.ui.todoSearch||"").trim().toLowerCase();
    todoSearch.value = state.ui.todoSearch || "";

    let list = [...state.todos];
    if(f==="active") list = list.filter(t=>!t.done);
    if(f==="done") list = list.filter(t=>t.done);
    if(q) list = list.filter(t=> (t.text||"").toLowerCase().includes(q));

    todoList.innerHTML = "";
    if(list.length === 0){
      const empty = document.createElement("div");
      empty.className = "muted";
      empty.textContent = q ? "è©²å½“ã™ã‚‹ToDoãŒã‚ã‚Šã¾ã›ã‚“ã€‚" : "ToDoã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚ï¼‹è¿½åŠ ã—ã¦ã­ã€‚";
      todoList.appendChild(empty);
    }else{
      for(const t of list){
        const row = document.createElement("div");
        row.className = "todoItem" + (t.done ? " done" : "");
        row.draggable = true;
        row.addEventListener("dragstart", (e)=> onDragStart(e, t.id));
        row.addEventListener("dragover", onDragOver);
        row.addEventListener("drop", (e)=> onDrop(e, t.id));

        const left = document.createElement("div");
        left.className = "todoLeft";

        const drag = document.createElement("span");
        drag.className = "drag";
        drag.textContent = "â‹®â‹®";
        drag.title = "ãƒ‰ãƒ©ãƒƒã‚°ã§ä¸¦ã¹æ›¿ãˆ";

        const cb = document.createElement("input");
        cb.type="checkbox";
        cb.checked = !!t.done;
        cb.addEventListener("change", ()=> toggleTodo(t.id));

        const text = document.createElement("div");
        text.className = "todoText";
        text.textContent = t.text;

        left.appendChild(drag);
        left.appendChild(cb);
        left.appendChild(text);

        const right = document.createElement("div");
        right.className = "todoRight";

        const del = document.createElement("button");
        del.className = "btn danger";
        del.style.padding = "8px 10px";
        del.textContent = "å‰Šé™¤";
        del.addEventListener("click", ()=> deleteTodo(t.id));

        right.appendChild(del);
        row.appendChild(left);
        row.appendChild(right);
        todoList.appendChild(row);
      }
    }

    // Links
    linksEl.innerHTML = "";
    state.links.forEach((l, idx)=>{
      const a = document.createElement("a");
      a.className = "link";
      a.href = l.url;
      a.target = "_blank";
      a.rel = "noopener noreferrer";

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `<b>${escapeHtml(l.title)}</b><small class="mono">${escapeHtml(l.url)}</small>`;

      const x = document.createElement("button");
      x.className = "btn danger";
      x.style.padding="8px 10px";
      x.textContent = "Ã—";
      x.title = "å‰Šé™¤";
      x.addEventListener("click", (e)=>{ e.preventDefault(); deleteLink(idx); });

      a.appendChild(meta);
      a.appendChild(x);
      linksEl.appendChild(a);
    });
  }

  // Boot
  applyAll();
  render();
  if(state.timer.running){ startTimer(); }
</script>
</body>
</html>